<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bailey Andrew">
<meta name="dcterms.date" content="2023-01-07">
<meta name="description" content="How to get good at Boulders and Valleys">

<title>Lorem Ipsomething - Boulders in Valleys Tips and Tricks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Lorem Ipsomething - Boulders in Valleys Tips and Tricks">
<meta property="og:description" content="How to get good at Boulders and Valleys">
<meta property="og:image" content="https://BaileyAndrew.github.io/Blog/000_Blog/005_BnV/basicbnv.png">
<meta property="og:site-name" content="Lorem Ipsomething">
<meta property="og:image:height" content="1045">
<meta property="og:image:width" content="1045">
<meta name="twitter:title" content="Lorem Ipsomething - Boulders in Valleys Tips and Tricks">
<meta name="twitter:description" content="How to get good at Boulders and Valleys">
<meta name="twitter:image" content="https://BaileyAndrew.github.io/Blog/000_Blog/005_BnV/basicbnv.png">
<meta name="twitter:image-height" content="1045">
<meta name="twitter:image-width" content="1045">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Lorem Ipsomething</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Boulders in Valleys Tips and Tricks</li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../blog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Blog</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../staticposts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Static Posts</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Puzzles</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../500_Puzzles/bnv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Boulders in Valleys</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slideshowindex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Slideshows</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../otherblogs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other People’s Blogs</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#boulders-in-valleys---tips-and-tricks" id="toc-boulders-in-valleys---tips-and-tricks" class="nav-link active" data-scroll-target="#boulders-in-valleys---tips-and-tricks">Boulders in Valleys - Tips and Tricks</a>
  <ul class="collapse">
  <li><a href="#beginner-tips" id="toc-beginner-tips" class="nav-link" data-scroll-target="#beginner-tips">Beginner Tips</a></li>
  <li><a href="#intermediate-tricks" id="toc-intermediate-tricks" class="nav-link" data-scroll-target="#intermediate-tricks">Intermediate Tricks</a></li>
  <li><a href="#advanced-techniques" id="toc-advanced-techniques" class="nav-link" data-scroll-target="#advanced-techniques">Advanced Techniques</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/BaileyAndrew/Blog/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Boulders in Valleys Tips and Tricks</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Fun</div>
  </div>
  </div>

<div>
  <div class="description">
    How to get good at Boulders and Valleys
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bailey Andrew </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 7, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="boulders-in-valleys---tips-and-tricks" class="level1">
<h1>Boulders in Valleys - Tips and Tricks</h1>
<p><a href="../../500_Puzzles/bnv.html">Boulders in Valleys</a> is a puzzle I enjoy creating. It is also a puzzle I enjoy solving. This post is all about solving techniques.</p>
<section id="beginner-tips" class="level2">
<h2 class="anchored" data-anchor-id="beginner-tips">Beginner Tips</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./basicbnv.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Simple rules to get a beginner started.</figcaption>
</figure>
</div>
<p>These are four basic techniques to get started. Don’t be intimidated by the variable names, if you see them in practice it’ll make sense.</p>
<p>The first pattern should be straightforward; a zero can’t roll anywhere, so it has to sit perched exactly where it is. The <strong style="color:#A6A440">x</strong>s are used to support the boulder to prevent it rolling off a corner.</p>
<p>The second pattern requires a bit more thinking, but if <span class="math inline">\(m\neq n+1\)</span> then, if it could fall straight down, it would be forced to follow the exact trajectory of <span class="math inline">\(n\)</span>, just from 1 higher - i.e.&nbsp;its deepest depth would be <span class="math inline">\(n+1\)</span>, a contradiction.</p>
<p>For the third pattern, we know that <span class="math inline">\(q\)</span> needs to roll but it can’t roll left or straight down; hence it needs to roll right. We can mark the place it has rolled to with <span class="math inline">\(r-1\)</span>, which can prove useful when the puzzle is difficult.</p>
<p>The fourth pattern is similar to the second and third in reasoning; if <span class="math inline">\(n\)</span> rolled left, it would be forced to follow <span class="math inline">\(p\)</span>’s deepest trajectory. As <span class="math inline">\(p &gt; n\)</span>, this is a contradiction.</p>
</section>
<section id="intermediate-tricks" class="level2">
<h2 class="anchored" data-anchor-id="intermediate-tricks">Intermediate Tricks</h2>
<p>To take your solving skills to the next step, you should learn some more advanced <strong style="color:#A6A440">patterns</strong>. In this section, a thick dashed line represents that we are “<strong style="color:#537FBF">conditioning</strong>” on an edge. That is, we ask ourselves “what happens if this edge is filled in, and what happens if it is crossed out?”. The goal is to find a contradiction down one of the paths, proving that it must be one way or the other.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BnV01pattern.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The Elbow Pattern</figcaption>
</figure>
</div>
<p>We can see that, if there is an edge to the left of the <strong style="color:#537FBF">1</strong>, the <strong style="color:#537FBF">1</strong> would fall too far. Hence we can arrive at the “elbow” shape shown on the right. This is quite a nice pattern in that it immediately gives you a lot of information about the board; 5 <strong style="color:#A6A440">x</strong>s and three edges is nothing to scoff at!</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bnvdroppattern.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The Drop Pattern</figcaption>
</figure>
</div>
<p>If a boulder is sandwiched between two same-direction-but-deeper boulders, then we know that the boulder has to fall straight down to prevent merging its trajectory with one of the adjacent boulders.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="BnVcornerpattern.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The Corner Pattern</figcaption>
</figure>
</div>
<p>The corner pattern is harder to derive, but also very useful. We can follow a chain of logic to show that there are only two possible local solutions to the pattern. This gives us two <strong style="color:#A6A440">x</strong>s and two edges, plus we know that the square marked by the diagonal dashed line either bends outwards or inwards. This is also a good pattern to have in your toolkit.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bnvrestingplacepattern.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The Resting Place Pattern</figcaption>
</figure>
</div>
<p>I won’t go through how to derive this pattern, as it’s a straightforward application of the <strong style="color:#A6A440">resting place rule</strong> descriped in the <strong style="color:#EB1960">Advanced Techniques</strong> section.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bnvboundary.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Boundary Conditions</figcaption>
</figure>
</div>
<p>The next trick is not a pattern, but an observation - since the grid has to be partitioned in two, if you already touch the boundary in two places you know you cannot touch it in any other place. This can give you quite a few <strong style="color:#A6A440">x</strong>s that are useful for near-boundary logics.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bnvphantom.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Phantom Boulders</figcaption>
</figure>
</div>
<p>The next trick is something that was touched upon in the beginner’s section; if you know a boulder has to fall one way, it can be useful to mark that cell with the new boulder’s information. The red cell is an implied boulder of depth 1, due to the fall path of the <strong style="color:#537FBF">3</strong>. As an example of how this might be useful, the grey edges show deductions that can be made using the phantom boulder and the corner pattern.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bnvstaircaseofdeath.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The Staircase of Death</figcaption>
</figure>
</div>
<p>In certain situations you can create a <strong style="color:#A6A440">staircase of death</strong>. If the <strong style="color:#537FBF">5↓</strong> rolls to the right, then it will trigger an cascade that can only be stopped by intersection with the grid boundary. If it would not touch the grid boundary at the right distance, then it produces an invalid configuration and can be ruled out - this forces the <strong style="color:#537FBF">5↓</strong> to roll left and the <strong style="color:#537FBF">5→</strong> to fall right.</p>
</section>
<section id="advanced-techniques" class="level2">
<h2 class="anchored" data-anchor-id="advanced-techniques">Advanced Techniques</h2>
<p>Advanced techniques can be very powerful, but require a deeper understanding of how <strong style="color:#EB1960">Boulders in Valleys</strong> works. I’m sure there are some other fundamental concepts that would qualify for being listed here, but that I don’t currently know as I’m still learning myself.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bnvadvanced.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The No-Traversal Rule</figcaption>
</figure>
</div>
<p>The “no-traversals” rule comes from a simple observation - no edge can cross the path of a falling boulder. If it does, then the boulder would either stop or roll to the side, thus changing its path. In the left image, we can see a possible path for the boulder to take. However, that would separate the two edges. Since the solution has to be connected, we know it cannot take this path! Thus, we can update our possible paths for the boulder (blue background) by taking this into account.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bnvadvanced2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Another use of the no-traversals rule</figcaption>
</figure>
</div>
<p>In this case, we can work out that the boulder falls straight down - if there were anything to its left deflecting it to the right, it would be stuck on the wrong side of the trajectory.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bnvendoftheline.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">The Resting Place Rule</figcaption>
</figure>
</div>
<p>Every boulder <strong style="color:#537FBF">n↓</strong> needs to have a <strong style="color:#A6A440">resting place</strong> exactly <span class="math inline">\(n\)</span> cells below it. Suppose the resting place were over the <strong style="color:#537FBF">0</strong>s, then we’d have a clear contradiction as it’d be resting on a corner. Hence it has to rest on the dashed line. This is the <strong style="color:#A6A440">resting place rule</strong>. Note that a resting place is not just a horizontal edge, but a horizontal edge with two <strong style="color:#A6A440">x</strong>s beneath it.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="bnvdiagpropagate.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Diagonal Propagations. Starting with a diagonal deduced (dashed line) and a well-placed <strong style="color:#537FBF">1↓</strong>, we can propagate the diagonal. The final deduction is in the bottom right.</figcaption>
</figure>
</div>
<p>As we saw from the <strong style="color:#A6A440">corner rule</strong>, we can sometimes get a “diagonal” deduced, saying that “either all edges on one side of the diagonal are filled in, or all edges on the other side are filled in”. Some things can extend this chain, such as a <strong style="color:#537FBF">1↓</strong> in the right place. Note that this extension has a minor flaw in that the diagonal is not “perfect” - one of the conditions allows a third edge on the diagonal to form a ‘u’ shape to catch the <strong style="color:#537FBF">1↓</strong>. However, if we kept on adding <strong style="color:#537FBF">1↓</strong>s to the up-right of the previous <strong style="color:#537FBF">1↓</strong>, we could continue to propagate this logic.</p>
<script src="https://giscus.app/client.js" data-repo="baileyandrew/blog" data-repo-id="R_kgDOInJwKg" data-category="Announcements" data-category-id="DIC_kwDOInJwKs4CTGOQ" data-mapping="title" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="dark_protanopia" data-lang="en" data-loading="lazy" crossorigin="anonymous" async="">
</script>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>